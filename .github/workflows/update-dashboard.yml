#
# GitHub Actions Workflow to automatically update the dashboard
#
name: Update Job Dashboard

# Controls when the action will run.
on:
  workflow_dispatch: # Allows you to run it manually from the Actions tab
  # schedule:
  #   - cron: '0 4 * * *' # Runs at 4 AM UTC every day

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # --- THIS IS THE CRITICAL PERMISSIONS BLOCK ---
    # It grants the workflow permission to write to your repository's contents.
    permissions:
      contents: write
    # ---------------------------------------------

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Step 1: Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout Repo
        uses: actions/checkout@v4

      # Step 2: Sets up a Python environment for use in the workflow
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # Step 3: Installs the necessary Python libraries
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install supabase pandas

      # Step 4: Runs the dashboard generator script
      # It uses the secrets we set up in the repository settings
      - name: Generate Dashboard
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: python dashboard_generator.py

      # Step 5: Commits the updated index.html file back to the repository
      - name: Commit and Push Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'docs: Update job dashboard'
          file_pattern: 'index.html'
